<!DOCTYPE html>
<html lang="zxx" layout:decorate="~{/layouts/layout}">
  <head>
    <meta charset="UTF-8" />
    <title>Edit Post</title>
    <!-- CSS 파일 경로 지정 -->
    <link rel="stylesheet" href="/css/board/register.css" />
  </head>
  <body>
    <div layout:fragment="content">
      <div class="write-content">
        <div class="write-article">
          <!-- 글 수정 폼 -->
          <form
            th:action="@{/board/modify}"
            th:object="${boardDto}"
            method="post"
            enctype="multipart/form-data"
          >
            <input
              type="hidden"
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"
            />
            <input type="hidden" th:field="*{bno}" />

            <!-- 카테고리 -->
            <div class="mb-3">
              <label for="categoryId" class="form-label">Category</label>
              <select
                class="form-select"
                id="categoryId"
                name="categoryId"
                th:field="*{categoryId}"
                required
              >
                <option value="" disabled>Select a category</option>
                <option
                  th:each="category : ${categories}"
                  th:value="${category.boardCNo}"
                  th:text="${category.name}"
                  th:selected="${boardDto.categoryId == category.boardCNo}"
                ></option>
              </select>
            </div>

            <!-- 제목 -->
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input
                type="text"
                class="form-control"
                id="title"
                name="title"
                th:field="*{title}"
                placeholder="Enter the title"
                maxlength="50"
                required
              />
            </div>

            <!-- 기존 이미지 표시 및 삭제 옵션 -->
            <div th:if="${boardDto.imageFileName}" class="mb-3">
              <label for="currentImage" class="form-label">Current Image</label>
              <div>
                <img
                  th:src="@{/upload/{filename}(filename=${boardDto.imageFileName})}"
                  alt="Current Image"
                  style="max-width: 100%; height: auto"
                />
              </div>
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="deleteImage"
                  name="deleteImage"
                  value="true"
                />
                <label for="deleteImage" class="form-check-label">
                  Delete Current Image
                </label>
              </div>
            </div>

            <!-- 새 이미지 업로드 -->
            <div class="mb-3">
              <label for="image" class="form-label">Upload New Image</label>
              <input
                type="file"
                class="form-control"
                id="image"
                name="imageFile"
              />
            </div>

            <!-- 내용 -->
            <div class="mb-3">
              <label for="content" class="form-label">Content</label>
              <textarea
                class="form-control"
                id="content"
                name="content"
                th:field="*{content}"
                rows="5"
                placeholder="Enter the content"
                maxlength="1300"
                required
                th:text="${#strings.replace(boardDto.content, '<br>', '\n')}"
              ></textarea>
            </div>

            <!-- 수정 버튼 -->
            <button type="submit" class="btn btn-primary">Save Changes</button>

            <!-- 취소 버튼 -->
            <a
              th:href="@{/board/detail/{bno}(bno=${boardDto.bno})}"
              class="btn btn-secondary"
              >Cancel</a
            >
          </form>
        </div>
      </div>
    </div>

    <!-- External JavaScript Dependencies -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const imageInput = document.querySelector("#image");
        const deleteImageCheckbox = document.querySelector("#deleteImage");

        // 디버깅용 로그
        if (!imageInput) {
          console.error("Image input field (#image) not found.");
        } else {
          console.log("Image input field found:", imageInput);
        }

        if (!deleteImageCheckbox) {
          console.error("Delete image checkbox (#deleteImage) not found.");
        } else {
          console.log("Delete image checkbox found:", deleteImageCheckbox);
        }

        // 이미지 선택 시 체크박스 상태 업데이트
        if (imageInput && deleteImageCheckbox) {
          imageInput.addEventListener("input", function () {
            console.log("File input changed. Files:", imageInput.files);
            if (imageInput.files && imageInput.files.length > 0) {
              console.log("File selected:", imageInput.files[0].name);
              deleteImageCheckbox.checked = true; // 파일이 선택되었을 경우 체크
            } else {
              console.log("No file selected.");
              deleteImageCheckbox.checked = false; // 파일 선택 취소 시 체크 해제
            }
          });
        }
      });
    </script>
  </body>
</html>
